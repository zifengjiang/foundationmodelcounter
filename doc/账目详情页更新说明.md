# 账目详情页更新说明

## 更新日期
2025-10-30

## 更新内容

### 1. 直接编辑模式
将账目详情页改为可直接编辑的界面，用户进入详情页后可以立即编辑所有字段，无需点击编辑按钮弹出新页面。

### 2. 主要改动

#### 界面改造
- **原设计**：只读的详情展示页 + 编辑按钮（点击后弹出新页面）
- **新设计**：可直接编辑的Form表单，所有字段均可即时修改

#### 可编辑字段
- 日期时间（DatePicker）
- 金额（TextField，支持快速金额选择）
- 货币类型（Picker）
- 大类选择（Menu）
- 小类选择（Menu）
- 商户/收入来源（TextField）
- 备注（多行TextField）

#### 保存功能
- 在导航栏右上角添加"保存"按钮（带✓图标）
- 保存按钮状态：
  - 有更改且金额有效时：启用
  - 无更改或金额无效时：禁用（灰色）
- 点击保存后自动关闭页面

#### 退出检测
- **更改检测**：实时监测以下字段的变化
  - 交易类型
  - 日期时间
  - 金额
  - 货币类型
  - 大类和小类
  - 商户信息
  - 备注内容

- **退出提示**：
  - 有未保存的更改时：
    - 隐藏系统默认的返回按钮
    - 在左上角显示"取消"按钮
    - 点击"取消"弹出确认对话框
    - 对话框选项：
      - "继续编辑"：关闭对话框，继续编辑
      - "放弃"：丢弃所有更改，返回上一页
  - 无更改或已保存时：
    - 正常显示返回按钮
    - 点击直接返回

### 3. 保留的功能
- 交易类型显示（支出/收入，带图标）
- 快速金额选择（10/20/50/100/200/500）
- 账单图片查看（可折叠，点击可全屏查看）
- 识别的原始文本查看（可折叠）
- 删除账目功能（底部红色按钮）
- 类目选择自动加载和更新

### 4. 用户体验优化
- **更快速的编辑**：无需额外点击进入编辑模式
- **明确的状态反馈**：保存按钮的启用/禁用状态清晰表明是否有更改
- **防止误操作**：退出时提示未保存的更改，避免数据丢失
- **触觉反馈**：保存和删除操作有震动反馈

### 5. 技术实现要点

#### 状态管理
```swift
// 编辑状态
@State private var date: Date
@State private var amount: String
@State private var currency: String
// ... 更多字段

// 更改检测
private var hasChanges: Bool {
    // 对比所有字段与原始值
}
```

#### 导航控制
```swift
// 有更改时隐藏返回按钮
.navigationBarBackButtonHidden(hasChanges)

// 有更改时显示取消按钮
.toolbar {
    if hasChanges {
        ToolbarItem(placement: .cancellationAction) {
            Button("取消") { showDiscardAlert = true }
        }
    }
}
```

#### 确认对话框
```swift
.alert("放弃更改", isPresented: $showDiscardAlert) {
    Button("继续编辑", role: .cancel) { }
    Button("放弃", role: .destructive) { dismiss() }
}
```

## 使用说明

1. **查看账目**：在主列表中点击任一账目进入详情页
2. **编辑信息**：直接点击任意字段进行修改
3. **保存更改**：修改完成后点击右上角"保存"按钮
4. **放弃更改**：点击左上角"取消"按钮，在弹出的对话框中选择"放弃"
5. **删除账目**：滚动到底部，点击红色"删除账目"按钮

## 注意事项
- 金额字段为必填项，为空时无法保存
- 更改后必须点击"保存"才能生效
- 退出前未保存的更改将丢失（会有提示）
- 保存后会自动更新类目使用次数

